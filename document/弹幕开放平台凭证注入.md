# 弹幕开放平台（DanDanPlay）AppId/AppSecret 注入说明

本项目访问 DanDanPlay 开放平台需要 `AppId` 与 `AppSecret`。为了避免把凭证写死在源码里，支持在**编译打包时注入**：

- 本地打包：通过环境变量或 Gradle 属性注入
- GitHub Actions：通过 GitHub Secrets 注入
- 兜底：未注入时，运行后仍可在应用内手动输入（本地会加密存储）

> 注意：只要凭证被打进 APK（即使是 `BuildConfig`），都无法做到“绝对不可被提取”，这里只是提升“随便就能看到”的难度。

## 注入方式

应用会从以下位置读取（优先级一致）：

- 环境变量：`DANDAN_APP_ID`、`DANDAN_APP_SECRET`
- Gradle 属性：`DANDAN_APP_ID`、`DANDAN_APP_SECRET`

当且仅当 **两者都非空** 时，构建产物会认为“已注入凭证”，运行时不会再自动弹出开发者认证提示。

## 本地构建（环境变量）

```bash
export DANDAN_APP_ID="你的AppId"
export DANDAN_APP_SECRET="你的AppSecret"

./gradlew assembleDebug
```

## 本地构建（Gradle 属性）

可放在 `~/.gradle/gradle.properties`（推荐，不进仓库）：

```properties
DANDAN_APP_ID=你的AppId
DANDAN_APP_SECRET=你的AppSecret
```

或者放在根目录 `local.properties`（同样不要提交）：

```properties
DANDAN_APP_ID=你的AppId
DANDAN_APP_SECRET=你的AppSecret
```

## GitHub Actions（Secrets）

在仓库 Settings → Secrets and variables → Actions 中配置：

- `DANDAN_APP_ID`
- `DANDAN_APP_SECRET`

然后在 workflow 中注入到环境变量（示例）：

```yaml
env:
  DANDAN_APP_ID: ${{ secrets.DANDAN_APP_ID }}
  DANDAN_APP_SECRET: ${{ secrets.DANDAN_APP_SECRET }}
```

## 运行时兜底（未注入时）

如果构建时没有提供上述两个值：

- 应用会按既有逻辑提示“开发者认证”
- 手动输入后会在本地以 Keystore + AES-GCM 方式加密存储（低版本 Android 会使用 RSA 包裹 AES Key 的兼容方案）

