## Context

当前媒体库配置入口为 `RouteTable.Stream.StoragePlus`（`StoragePlusActivity`），会根据 `MediaType` 打开对应的 `StorageEditDialog`（底部弹窗）。现状交互：

- 用户修改字段 → 点击底部“确定” → 调用 `StoragePlusActivity.addStorage()` → `StoragePlusViewModel.addStorage()` 写入 DB 并触发退出。
- 用户点击底部“取消” → 直接退出，不会保存任何修改。

该模式在 TV 端交互成本较高，且“是否已保存”依赖用户记忆。

## Goals / Non-Goals

**Goals**

1. 移除媒体库配置弹窗底部“确定/取消”按钮，用户可直接返回/下滑关闭。
2. 在不引入新的跨模块依赖边的前提下，实现“修改即生效”：配置变更自动持久化并被后续媒体库访问使用。
3. 对需要显式动作/网络校验的流程（扫码登录、测试连接、投屏连接等）保留其动作入口，但不再需要额外“确定”提交。
4. 保持对既有调用方兼容：需要 `RESULT_OK` 的场景仍能得到正确的刷新触发。

**Non-Goals**

- 不引入“撤销/历史版本”能力。
- 不把“测试连接”改为自动触发（避免网络与弹窗噪音）。
- 不在本次变更中调整媒体库管理入口/列表样式（仅针对配置生效与按钮）。

## Decisions

### 1) 自动保存触发策略：轻量变更自动、重操作显式

- **轻量变更**（文本输入、开关/单选切换）：
  - 变更后触发自动保存。
  - 文本输入采用 debounce（例如 300–500ms）或失焦提交，避免每个字符都写库。
  - 仅当配置满足最小校验（各类型原有 `checkParams(...)` 的“无 toast 版本”）时才写库；非法/未完成输入不保存。
- **重操作/需要校验**（扫码登录、连接测试、投屏连接）：
  - 仍由用户点击对应动作按钮触发。
  - 动作成功后自动持久化并设置 `RESULT_OK`，无需“确定”。

### 2) 新增 vs 编辑：避免产生半成品媒体库记录

- **编辑模式（已有库）**：在配置“合法”时写库；不合法时不写入，离开页面会丢弃未保存的草稿状态。
- **新增模式（无库）**：仅在配置满足最小校验且必要的鉴权已完成后才写入 DB；用户在未完成配置时退出不会创建记录。

### 3) 兼容返回结果：以“发生过成功持久化”为准

`StoragePlusActivity` 不再在每次保存后自动 `finish()`，而是：

- 只要发生过一次“成功持久化/生效”，就调用 `setResult(RESULT_OK)`（可通过 Activity 内部状态或 ViewModel 事件驱动）。
- 页面关闭仍由“返回键/手势/下滑关闭弹窗”触发（`StorageEditDialog` dismiss → finish activity）。

这样可保持例如 Open115 重新鉴权后回到目录页面的刷新逻辑不被破坏。

### 4) 投屏手动连接的动作迁移

`ScreencastStorageEditDialog` 当前将“确定”作为手动连接入口。移除底部按钮后，需要将连接动作迁移到内容区更语义化的按钮（例如“直连/密码连接”按钮点击即执行连接），并在连接成功后自动写入/更新媒体库记录。

## Risks / Trade-offs

- **写库频繁**：通过 debounce + “仅合法时写入”减少写入次数。
- **toast 轰炸**：自动保存路径避免在输入过程中弹出必填提示；仅在用户执行显式动作（测试/登录/连接）失败时提示。
- **不同存储类型规则不一致**：优先复用各对话框已有 `checkParams(...)` 规则，并抽取统一的“无 toast 校验/规范化”路径，确保一致性。

## Open Questions

1. 对“编辑已有库但当前输入非法”的离开行为：是否需要提示“未保存”再退出？（本提案默认不提示，避免打断 TV 操作。）
2. 是否需要在 UI 上提供轻量的“已保存/待完善”状态文案？（本提案默认不新增，仅保证行为正确。）
